---
title: "Poisson Analysis on Vote Arrivals per Rank"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DBI)
library(dplyr)
library(ggplot2)
con <- RSQLite::dbConnect(RSQLite::SQLite(), "../hacker-news-dataset.sqlite")
```




**Wikipedia definition**

"In probability theory and statistics, the Poisson distribution, named after French mathematician SimÃ©on Denis Poisson, is a discrete probability distribution that expresses the probability of a given number of events occurring in a fixed interval of time or space if these events occur with a known constant mean rate and independently of the time since the last event. The Poisson distribution can also be used for the number of events in other specified intervals such as distance, area or volume. For instance, a call center receives an average of 180 calls per hour, 24 hours a day. The calls are independent; receiving one does not change the probability of when the next one will arrive. The number of calls received during any minute has a Poisson probability distribution: the most likely numbers are 2 and 3 but 1 and 4 are also likely and there is a small probability of it being as low as zero and a very small probability it could be 10. Another example is the number of decay events that occur from a radioactive source during a defined observation period."

In our case, the number of votes arriving per unit time are the events of interest.




```{r}

dbGetQuery(con, '
  select sampleTime, topRank, gain 
  from dataset
  inner join fullstories on fullstories.id = dataset.id
  where topRank is not null
') %>% 
  as_tibble() %>%
  mutate(sampleTimeDateTime = lubridate::as_datetime(sampleTime)) %>% 
  mutate(sampleTimeDate = lubridate::date(sampleTimeDateTime),
         sampleTimeHour = lubridate::hour(sampleTimeDateTime),
         sampleTimeMinute = lubridate::minute(sampleTimeDateTime)) %>% 
  mutate(sampleTimeTenMinutes = sampleTimeMinute %/% 10) %>% 
  select(-sampleTime, -sampleTimeDateTime) -> data

  

```

Let's first look at rank 1 of the front page.

```{r}

data %>% 
  filter(topRank == 1) %>% 
  filter(gain <= 10) %>% 
  group_by(sampleTimeDate, sampleTimeHour, sampleTimeMinute) %>% 
  summarize(gain = sum(gain)) %>% 
  ungroup() %>% 
  ggplot(aes(x = gain)) +
  geom_histogram(binwidth = 1)
  

```


```{r}

data %>% 
  group_by(topRank) %>% 
  summarize(meanGainPerMinute = mean(gain)) %>% 
  ungroup() %>% 
  ggplot(aes(x = topRank, y = meanGainPerMinute)) +
  geom_line() + 
  geom_point()
  


```






# Disconnect from Database

Don't forget to disconnect after session:

```{r}
RSQLite::dbDisconnect(conn = con)
```

