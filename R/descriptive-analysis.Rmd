---
title: "Dataset Description"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

library(DBI)
library(dplyr)
library(ggplot2)

con <- RSQLite::dbConnect(RSQLite::SQLite(), file.path("..", "hacker-news-dataset.sqlite"))

```





### Overview

```{r}

tbl(con, "dataset") %>% 
  head(10)

```


### What data did we sample?

```{r}

tbl(con, "dataset") %>% 
  head() %>%
  data.frame() %>% 
  names()

```

**Explanation:**

  * `id`: identifier
  * `score`: number of votes obtained at that timeslice
  * `topRank`: rank on hacker news *front* page
  * `descendants`: number of first level comments (not including comments on comments)
  * `submissionTime`: timestamp of submission of item
  * `sampleTime`: timestamp of retrieval
  * `samplingWindow`: the scraper ran over four distinct continuous periods, this variable designates the sampling period that the respective sample belongs to
  * `tick`: convenience column for later simulation; assings a continuous numbering to the sampling timestamps
  * `newRank`: rank on hacker news *new* page
  * `bestRank`: rank on hacker news *best* page
  * `askRank`: rank on hacker news *ask* page
  * `showRank`: rank on hacker news *show* page
  * `jobRank`: rank on hacker news *job* page
  * `gain`: number of votes gained since the last `sampleTime`
  



### Number of sampled stories

**Number of unique stories (overall):**

```{r}

n_unique_stories <- tbl(con, "dataset") %>% 
  select(id) %>% 
  distinct() %>% 
  data.frame() %>% 
  nrow()

```

**Number of full stories (observed for their entire runs):**

```{r}

tbl(con, "fullstories") %>% 
  distinct() %>% 
  data.frame() %>% 
  nrow()

```


### Sampling timeframe

```{r}

tbl(con, "dataset") %>% 
  select(sampleTime) %>% 
  distinct() %>% 
  data.frame() %>% 
  ggplot(aes(x = sampleTime)) +
  geom_histogram()

```


### Example story

```{r example-story}

example_story <- tbl(con, "dataset") %>% 
  filter(id == 26660877) %>% 
  data.frame()

```


```{r example-story-score-over-time}

example_story %>%
  mutate(sampleTimeDT = lubridate::as_datetime(sampleTime)) %>% 
  ggplot(aes(x = sampleTimeDT, y = score)) +
  geom_line()

```







# Disconnect from Database

```{r db-disconnect}

RSQLite::dbDisconnect(conn = con)

```


